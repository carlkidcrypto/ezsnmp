==========
C++ Tests
==========

Overview
========
This directory contains C++ unit tests for the EzSnmp library's native C++ components.
These tests validate the low-level SNMP operations and C++ class functionality.

Purpose
=======
The C++ tests ensure that:

* SessionBase class operations work correctly
* Exception handling in C++ layer functions properly
* Data type conversions between C++ and Python are accurate
* Net-SNMP library integration is stable
* Memory management is correct and leak-free

Test Components
===============
The tests in this directory cover:

* SNMP session management
* GET, SET, WALK, BULKGET, and BULKWALK operations
* Error handling and exception propagation
* Thread safety of C++ components
* SWIG interface bindings

Usage
=====

**Local Testing (Native)**

For detailed instructions on building and running C++ tests locally, please refer to the 
`Development Guide <../sphinx_docs_build/source/development.rst>`_.

**Docker-Based Testing (Recommended)**

The recommended approach for testing is to use the Docker-based testing infrastructure, which provides:

* Consistent build and test environments across multiple Linux distributions
* Pre-configured compilers and build tools (g++ 9.5+ or higher)
* Automated coverage report generation
* Parallel execution across all supported distributions

.. code-block:: bash

    # Run C++ tests across all distributions
    cd docker/
    ./run_cpp_tests_in_all_dockers.sh

    # Run C++ tests in a specific distribution only
    ./run_cpp_tests_in_all_dockers.sh rockylinux8

The Docker testing infrastructure tests across:

* **5 Linux distributions**: AlmaLinux 10, Arch Linux, Arch Linux (net-snmp 5.8), CentOS 7, Rocky Linux 8
* **Multiple compiler versions**: g++ 11.2.1 to 14.x depending on distribution
* **Automated coverage**: Generates lcov coverage reports for each distribution

Output files are generated in the ``docker/`` directory:
- ``test-results_<distribution>_test_container.xml`` - Test results in JUnit format
- ``test-outputs_<distribution>_test_container.txt`` - Test execution logs
- ``lcov_coverage_<distribution>_test_container.info`` - Code coverage data

For more details, see the `Docker README <../docker/README.rst>`_.

Prerequisites
=============
To run these tests, you need:

* Meson and Ninja build tools
* Net-SNMP development libraries
* Google Test framework (or similar C++ testing framework)
* C++ compiler with C++17 support

Related Documentation
=====================
* `Main README <../README.rst>`_
* `Development Guide <../sphinx_docs_build/source/development.rst>`_
* `Python Tests <../python_tests/README.rst>`_
* `C++ Source Code <../ezsnmp/src/>`_

Code Coverage
=============
The C++ tests aim for high code coverage. However, some code paths are difficult or 
impossible to test in unit tests:

**Untestable in Unit Tests (require integration testing or fault injection):**

* Memory allocation failures (calloc, strdup failures) - require fault injection
* Buffer overflow/truncation in net-snmp functions - requires specific data conditions
* Specific SNMP error conditions (timeouts, connection errors, packet errors) - requires live SNMP server with error conditions
* SNMPv3 USM user cache management (``remove_v3_user_from_cache``) - requires SNMPv3 session with authenticated users

These code paths are tested through integration tests or are defensive error handling for 
rare system-level failures. The realistic unit test coverage target is approximately 75-80%.

To generate coverage reports, run::

    ./get_test_coverage.sh

The coverage report will be generated in ``coverage_html/index.html``.

----

.. note::
   This content was generated by AI and reviewed by humans. Mistakes may still occur. PRs for corrections are welcome.

